<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자용 점포 위치 제작</title>
  <style>
    body { font-family: Arial; text-align:center; margin:20px; background:#f9f9f9; }
    #floorplanContainer { position:relative; width:80vw; height:60vw; margin:0 auto; border:2px solid #333; background:#fff; max-width:1200px; max-height:900px; }
    #floorplanImage { width:100%; height:100%; object-fit:contain; display:block; pointer-events:none; }
    .marker { position:absolute; width:18px; height:18px; background:red; border-radius:50%; transform:translate(-50%,-50%); cursor:pointer; border:2px solid white; box-shadow:0 0 3px rgba(0,0,0,0.3); }
  </style>
</head>
<body>

<h1>관리자용 점포 위치 제작</h1>

<input type="file" id="imageUploader" accept="image/*" />
<button onclick="downloadJSON()">JSON 다운로드</button>
<button onclick="downloadImage()">Floor Plan 다운로드</button>

<div id="floorplanContainer">
  <img id="floorplanImage" alt="업로드 필요" />
</div>

<script>
const floorplanContainer = document.getElementById('floorplanContainer');
const floorplanImage = document.getElementById('floorplanImage');
const imageUploader = document.getElementById('imageUploader');

let storeMarkers = [];

// 이미지 업로드
imageUploader.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = evt=>{
    floorplanImage.src = evt.target.result;
    storeMarkers=[];
    renderMarkers();
  };
  reader.readAsDataURL(file);
});

// 마커 찍기
floorplanContainer.addEventListener('click', e=>{
  const rect = floorplanContainer.getBoundingClientRect();
  const xPercent = ((e.clientX - rect.left)/rect.width)*100;
  const yPercent = ((e.clientY - rect.top)/rect.height)*100;
  const name = prompt('점포 이름:');
  if(!name) return;
  const info = prompt('추가 정보(선택):','');
  storeMarkers.push({name, xPercent, yPercent, info});
  renderMarkers();
});

// 마커 렌더링
function renderMarkers(){
  floorplanContainer.querySelectorAll('.marker').forEach(m=>m.remove());
  storeMarkers.forEach(m=>{
    const div = document.createElement('div');
    div.className='marker';
    div.style.left = m.xPercent+'%';
    div.style.top = m.yPercent+'%';
    div.title = m.name + (m.info?'\n'+m.info:'');
    floorplanContainer.appendChild(div);
  });
}

// JSON 다운로드
function downloadJSON(){
  const blob = new Blob([JSON.stringify(storeMarkers,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='locations.json';
  a.click();
  URL.revokeObjectURL(url);
}

// Floor Plan 다운로드
function downloadImage(){
  const a = document.createElement('a');
  a.href = floorplanImage.src;
  a.download = 'floorplan.png';
  a.click();
}
</script>

</body>
</html>